window.__require=function e(t,n,a){function o(i,c){if(!n[i]){if(!t[i]){var l=i.split("/");if(l=l[l.length-1],!t[l]){var _="function"==typeof __require&&__require;if(!c&&_)return _(l,!0);if(r)return r(l,!0);throw new Error("Cannot find module '"+i+"'")}}var s=n[i]={exports:{}};t[i][0].call(s.exports,function(e){return o(t[i][1][e]||e)},s,s.exports,e,t,n,a)}return n[i].exports}for(var r="function"==typeof __require&&__require,i=0;i<a.length;i++)o(a[i]);return o}({CubeGameFSM:[function(e,t,n){"use strict";cc._RF.push(t,"4b7c05iT/VOV5B0/wdA7HLu","CubeGameFSM"),Object.defineProperty(n,"__esModule",{value:!0});var a=e("./StateMachine"),o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.stateName={SelectGame:"SelectGame",GameReady:"GameReady",GamePlay:"GamePlay",GameOver:"GameOver",GameWin:"GameWin",GameInit:"GameInit"},t.eventName={select:"select",game_play:"game_play",play_again:"play_again",time_out:"time_out",game_win:"game_win",goto_next:"goto_next",click_cube:"click_cube",back_select_game:"back_select_game"},t}return __extends(t,e),t.prototype.fsmTrigger=function(e){for(var t,n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];(t=this.fsm)[e].apply(t,n)},t.prototype.fsmIs=function(e){return this.fsm.is(e)},t.prototype.fsmCan=function(e){return this.fsm.can(e)},t.prototype.fsmCannot=function(e){return this.fsm.cannot(e)},t.prototype.fsmCurrent=function(){return this.fsm.current},t.prototype.fsmStartUp=function(){this.fsm=a.default.create({initial:"SelectGame",events:[{name:"select",from:"SelectGame",to:"GameInit"},{name:"game_play",from:"GameReady",to:"GamePlay"},{name:"play_again",from:"GameOver",to:"GameInit"},{name:"time_out",from:"GamePlay",to:"GameOver"},{name:"game_win",from:"GamePlay",to:"GameWin"},{name:"goto_next",from:"GameWin",to:"GameOver"},{name:"click_cube",from:"GamePlay",to:"GamePlay"},{name:"back_select_game",from:"GameOver",to:"SelectGame"},{name:"goto_next",from:"GameInit",to:"GameReady"}],callbacks:{onenterSelectGame:[this.enter_select_game],onleaveSelectGame:[this.leave_select_game],onenterGameReady:[this.enter_game_ready],onleaveGameReady:[this.leave_game_ready],onenterGamePlay:[this.enter_game_play],onleaveGamePlay:[this.leave_game_play],onenterGameOver:[this.enter_game_over],onleaveGameOver:[this.leave_game_over],onenterGameWin:[this.enter_game_win],onleaveGameWin:[this.leave_game_win],onenterGameInit:[this.enter_game_init],onleaveGameInit:[this.leave_game_init],onbeforeselect:{SelectGame:[this.action_select]},onbeforegame_play:{GameReady:[this.action_game_play]},onbeforeclick_cube:{GamePlay:[this.action_click_cube]},onenterstate:[this.global_enter],onleavestate:[this.global_leave],onbeforeevent:[this.global_before],onafterevent:[this.global_after]}},this)},t.prototype.select=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];(e=this.fsm).select.apply(e,t)},t.prototype.game_play=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];(e=this.fsm).game_play.apply(e,t)},t.prototype.play_again=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];(e=this.fsm).play_again.apply(e,t)},t.prototype.time_out=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];(e=this.fsm).time_out.apply(e,t)},t.prototype.game_win=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];(e=this.fsm).game_win.apply(e,t)},t.prototype.goto_next=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];(e=this.fsm).goto_next.apply(e,t)},t.prototype.click_cube=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];(e=this.fsm).click_cube.apply(e,t)},t.prototype.back_select_game=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];(e=this.fsm).back_select_game.apply(e,t)},t}(cc.Component);n.default=o,cc._RF.pop()},{"./StateMachine":"StateMachine"}],GameMgr:[function(e,t,n){"use strict";cc._RF.push(t,"e14bari4MxKG4zaICPz1sYz","GameMgr"),Object.defineProperty(n,"__esModule",{value:!0});var a=cc._decorator,o=a.ccclass,r=a.property,i=a.help,c=e("./fsm/CubeGameFSM"),l=e("./Timer"),_=e("./PlayChangeColor"),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.scene_ng="ng",t._game_level=0,t.level_timer=[],t.level_cube_count=[],t.prefab_select_game=null,t.prefab_ui=null,t.prefab_ready_anime=null,t.prefab_cube=null,t.prefab_game_over_anime=null,t.prefab_game_win_anime=null,t.prefab_btn_back_select_game=null,t.canvas=null,t._cube_array=[],t._cube_target=0,t._god_index=0,t}return __extends(t,e),t.prototype.start=function(){try{this.fsmStartUp()}catch(e){cc.error(e)}},t.prototype.playCubeBoom=function(e){e.stopAllActions(),e.removeComponent(cc.Button);var t=e.getComponent(cc.Animation);t.on("finished",function(t){e.destroy()},this),t.play();var n=this.level_cube_count[this._game_level-1];this._cube_array[this._cube_target-1]=null,this._cube_target+=1,this._cube_target>n?this.fireEvent("game_win"):this.canvas.getChildByName("ui").getChildByName("label_next").getComponent(cc.Label).string="Next: "+this._cube_target},t.prototype.god=function(e,t){var n=this;this._god_index=0,e.target.stopAllActions(),e.target.runAction(cc.sequence(cc.delayTime(1/this._cube_array.length),cc.callFunc(function(){cc.log(n._god_index);var e=n._cube_array[n._god_index];e&&n.playCubeBoom(e),n._god_index+=1})).repeat(this._cube_array.length))},t.prototype.fireEvent=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];cc.log(this.name+".fireEvent : event:"+e+", data:"+t);try{this.fsmTrigger(e,t)}catch(e){cc.error(e)}},t.prototype.enter_select_game=function(e,t,n){for(var a=this,o=[],r=3;r<arguments.length;r++)o[r-3]=arguments[r];cc.log(this.name+".enter_select_game : args:"+o);var i=cc.instantiate(this.prefab_select_game);i.getChildByName("btn_level1").getComponent(cc.Button).node.on("click",function(e){a._game_level=1,a.fireEvent("select")},this),i.getChildByName("btn_level2").getComponent(cc.Button).node.on("click",function(e){a._game_level=2,a.fireEvent("select")},this),i.getChildByName("btn_level3").getComponent(cc.Button).node.on("click",function(e){a._game_level=3,a.fireEvent("select")},this),this.canvas.addChild(i,0,"select_game")},t.prototype.leave_select_game=function(e,t,n){for(var a=[],o=3;o<arguments.length;o++)a[o-3]=arguments[o];this.canvas.removeChild(this.canvas.getChildByName("select_game"))},t.prototype.enter_game_init=function(e,t,n){for(var a=this,o=[],r=3;r<arguments.length;r++)o[r-3]=arguments[r];cc.log(this.name+".enter_game_init : args:"+o),this._cube_target=1,this.canvas.removeChild(this.canvas.getChildByName("ui"));var i=this.level_timer[this._game_level-1],c=cc.instantiate(this.prefab_ui);c.getChildByName("label_time").getComponent(cc.Label).string="Time: "+i,c.getChildByName("label_level").getComponent(cc.Label).string="Level: "+this._game_level,c.getChildByName("label_next").getComponent(cc.Label).string="Next: "+this._cube_target,this.canvas.addChild(c,1,"ui");for(var l=0,_=this._cube_array;l<_.length;l++){var s=_[l];s&&s.destroy()}this._cube_array=[];for(var m=this.level_cube_count[this._game_level-1],h=function(e){var t=cc.instantiate(u.prefab_cube);t.on("click",function(e){t.name==a._cube_target.toString()&&a.playCubeBoom(t)},u),t.getChildByName("label_id").getComponent(cc.Label).string=e.toString(),t.getComponent(cc.Button).interactable=!1,u.canvas.addChild(t,0,""+e),u._cube_array.push(t)},u=this,p=1;p<=m;p++)h(p);this.fireEvent("goto_next")},t.prototype.leave_game_init=function(e,t,n){for(var a=[],o=3;o<arguments.length;o++)a[o-3]=arguments[o];cc.log(this.name+".leave_game_init : args:"+a)},t.prototype.enter_game_ready=function(e,t,n){for(var a=this,o=[],r=3;r<arguments.length;r++)o[r-3]=arguments[r];cc.log(this.name+".enter_game_ready : args:"+o);var i=cc.instantiate(this.prefab_ready_anime);i.getComponent(cc.Animation).on("finished",function(e){a.fireEvent("game_play")},this),this.canvas.addChild(i,0,"ready_anime")},t.prototype.leave_game_ready=function(e,t,n){for(var a=[],o=3;o<arguments.length;o++)a[o-3]=arguments[o];cc.log(this.name+".leave_game_ready : args:"+a),this.canvas.removeChild(this.canvas.getChildByName("ready_anime"))},t.prototype.enter_game_play=function(e,t,n){for(var a=this,o=[],r=3;r<arguments.length;r++)o[r-3]=arguments[r];cc.log(this.name+".enter_game_play : args:"+o);var i=this.level_timer[this._game_level-1];this._game_level>=2&&(this.canvas.getChildByName("sprite_BG").addComponent(_.default).game_timer=i);this.canvas.getChildByName("ui").getChildByName("label_time").getComponent(l.default).startTimer(i,function(){a.fireEvent("time_out")});for(var c=function(e){if(e){e.getComponent(cc.Button).interactable=!0;var t=cc.sequence(cc.callFunc(function(){e.runAction(cc.moveTo(1,cc.v2(a.node.getContentSize().width/2+Math.random()*cc.winSize.width-a.node.getContentSize().width/2-cc.winSize.width/2,a.node.getContentSize().height/2+Math.random()*cc.winSize.height-a.node.getContentSize().height/2-cc.winSize.height/2)))},s),cc.delayTime(1),cc.delayTime(2));e.runAction(t.repeatForever())}},s=this,m=0,h=this._cube_array;m<h.length;m++){c(h[m])}},t.prototype.leave_game_play=function(e,t,n){for(var a=[],o=3;o<arguments.length;o++)a[o-3]=arguments[o];cc.log(this.name+".leave_game_play : args:"+a)},t.prototype.enter_game_over=function(e,t,n){for(var a=this,o=[],r=3;r<arguments.length;r++)o[r-3]=arguments[r];cc.log(this.name+".enter_game_over : args:"+o),this.canvas.getChildByName("sprite_BG").removeComponent(_.default);var i=cc.instantiate(this.prefab_game_over_anime);i.on("click",function(e){a.fireEvent("play_again")},this),this.canvas.addChild(i,0,"game_over_anime");for(var c=0,l=this._cube_array;c<l.length;c++){var s=l[c];s&&(s.removeComponent(cc.Button),s.stopAllActions())}var m=cc.instantiate(this.prefab_btn_back_select_game);m.on("click",function(e){a.fireEvent("back_select_game")},this),this.canvas.addChild(m,0,"btn_back_select_game")},t.prototype.leave_game_over=function(e,t,n){for(var a=[],o=3;o<arguments.length;o++)a[o-3]=arguments[o];cc.log(this.name+".leave_game_over : args:"+a),this.canvas.removeChild(this.canvas.getChildByName("game_over_anime")),this.canvas.removeChild(this.canvas.getChildByName("btn_back_select_game"))},t.prototype.enter_game_win=function(e,t,n){for(var a=this,o=[],r=3;r<arguments.length;r++)o[r-3]=arguments[r];cc.log(this.name+".enter_game_win : args:"+o);var i=cc.instantiate(this.prefab_game_win_anime);i.on("click",function(e){a.fireEvent("play_again")},this),this.canvas.addChild(i,0,"game_win_anime"),this.canvas.getChildByName("ui").getChildByName("label_time").removeComponent(l.default),this.fireEvent("goto_next")},t.prototype.leave_game_win=function(e,t,n){for(var a=[],o=3;o<arguments.length;o++)a[o-3]=arguments[o];cc.log(this.name+".leave_game_win : args:"+a),this.canvas.removeChild(this.canvas.getChildByName("game_win_anime"))},t.prototype.action_select=function(e,t,n){for(var a=[],o=3;o<arguments.length;o++)a[o-3]=arguments[o];cc.log(this.name+".action_select : args:"+a)},t.prototype.action_game_play=function(e,t,n){for(var a=[],o=3;o<arguments.length;o++)a[o-3]=arguments[o];cc.log(this.name+".action_game_play : args:"+a)},t.prototype.action_click_cube=function(e,t,n){for(var a=[],o=3;o<arguments.length;o++)a[o-3]=arguments[o];cc.log(this.name+".action_click_cube : args:"+a)},t.prototype.global_enter=function(e,t,n){for(var a=[],o=3;o<arguments.length;o++)a[o-3]=arguments[o]},t.prototype.global_leave=function(e,t,n){for(var a=[],o=3;o<arguments.length;o++)a[o-3]=arguments[o]},t.prototype.global_before=function(e,t,n){for(var a=[],o=3;o<arguments.length;o++)a[o-3]=arguments[o]},t.prototype.global_after=function(e,t,n){for(var a=[],o=3;o<arguments.length;o++)a[o-3]=arguments[o];cc.log("global_after("+e+","+t+","+n+","+a+")"),this.getComponent(cc.Label).string="State: "+n},__decorate([r],t.prototype,"scene_ng",void 0),__decorate([r],t.prototype,"_game_level",void 0),__decorate([r([cc.Integer])],t.prototype,"level_timer",void 0),__decorate([r([cc.Integer])],t.prototype,"level_cube_count",void 0),__decorate([r(cc.Prefab)],t.prototype,"prefab_select_game",void 0),__decorate([r(cc.Prefab)],t.prototype,"prefab_ui",void 0),__decorate([r(cc.Prefab)],t.prototype,"prefab_ready_anime",void 0),__decorate([r(cc.Prefab)],t.prototype,"prefab_cube",void 0),__decorate([r(cc.Prefab)],t.prototype,"prefab_game_over_anime",void 0),__decorate([r(cc.Prefab)],t.prototype,"prefab_game_win_anime",void 0),__decorate([r(cc.Prefab)],t.prototype,"prefab_btn_back_select_game",void 0),__decorate([r(cc.Node)],t.prototype,"canvas",void 0),__decorate([r([cc.Node])],t.prototype,"_cube_array",void 0),__decorate([r(cc.Integer)],t.prototype,"_cube_target",void 0),__decorate([r(cc.Integer)],t.prototype,"_god_index",void 0),t=__decorate([o,i("https://forum.cocos.com/t/cocos-creator-typescript/46515")],t)}(c.default);n.default=s,cc._RF.pop()},{"./PlayChangeColor":"PlayChangeColor","./Timer":"Timer","./fsm/CubeGameFSM":"CubeGameFSM"}],PlayChangeColor:[function(e,t,n){"use strict";cc._RF.push(t,"eccbcfxN75Iuo0bdDX3/S6e","PlayChangeColor"),Object.defineProperty(n,"__esModule",{value:!0});var a=cc._decorator,o=a.ccclass,r=a.property,i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._color_bg=cc.Color.WHITE,t._tint_time=2,t._tint_delta=2,t.game_timer=2,t}return __extends(t,e),t.prototype.start=function(){this._tint_delta=this._tint_time,this.startRandom()},t.prototype.randomRGB=function(){this._color_bg=cc.color(256*Math.random(),256*Math.random(),256*Math.random())},t.prototype.startRandom=function(){cc.log(this.name+": startRandom"),this.node.runAction(cc.sequence(cc.callFunc(this.randomRGB,this),cc.tintTo(this._tint_delta,this._color_bg.getR(),this._color_bg.getG(),this._color_bg.getB()),cc.callFunc(this.startRandom,this)))},t.prototype.update=function(e){this._tint_delta>.1&&(this._tint_delta-=this._tint_time*e/this._tint_time*this._tint_time/this.game_timer,this._tint_delta<.1&&(this._tint_delta=.1))},t.prototype.onDestroy=function(){this.node.stopAllActions(),this.node.runAction(cc.tintTo(.5,133,133,133))},__decorate([r],t.prototype,"_color_bg",void 0),__decorate([r],t.prototype,"_tint_time",void 0),__decorate([r],t.prototype,"_tint_delta",void 0),__decorate([r],t.prototype,"game_timer",void 0),t=__decorate([o],t)}(cc.Component);n.default=i,cc._RF.pop()},{}],StateMachine:[function(e,t,n){"use strict";cc._RF.push(t,"0d223f1Ea1OkaVt9j2bTGRJ","StateMachine"),Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(){}return e.create=function(t,n){var a="string"==typeof t.initial?{state:t.initial}:t.initial,o=t.terminal||t.final,r=n,i=t.events||[],c=t.callbacks||{},l={},_={},s=function(t){var n=Array.isArray(t.from)?t.from:t.from?[t.from]:[e.WILDCARD];l[t.name]=l[t.name]||{};for(var a=0;a<n.length;a++)_[n[a]]=_[n[a]]||[],_[n[a]].push(t.name),l[t.name][n[a]]=t.to||n[a];t.to&&(_[t.to]=_[t.to]||[])};a&&(a.event=a.event||"startup",s({name:a.event,from:"none",to:a.state}));for(var m=0;m<i.length;m++)s(i[m]);for(var h in l)l.hasOwnProperty(h)&&(r[h]=e.buildEvent(h,l[h]));for(var h in c)c.hasOwnProperty(h)&&(r[h]=c[h]);return r.current="none",r.is=function(e){return Array.isArray(e)?e.indexOf(this.current)>=0:this.current===e},r.can=function(t){return!this.transition&&void 0!==l[t]&&(l[t].hasOwnProperty(this.current)||l[t].hasOwnProperty(e.WILDCARD))},r.cannot=function(e){return!this.can(e)},r.transitions=function(){return(_[this.current]||[]).concat(_[e.WILDCARD]||[])},r.isFinished=function(){return this.is(o)},r.error=t.error||function(e,t,n,a,o,r,i){throw i||r},r.states=function(){return Object.keys(_).sort()},a&&!a.defer&&r[a.event](),r},e.doCallback=function(t,n,a,o,r,i){if(n)try{if(Array.isArray(n)){for(var c=0,l=n.length;c<l;c++)n[c].apply(t,[a,o,r].concat(i));return!0}for(c=0,l=n[o].length;c<l;c++)n[o][c].apply(t,[a,o,r].concat(i));return!0}catch(n){return t.error(a,o,r,i,e.Error.INVALID_CALLBACK,"an exception occurred in a caller-provided callback function",n),!0}return!0},e.beforeAnyEvent=function(t,n,a,o,r){return e.doCallback(t,t.onbeforeevent,n,a,o,r)},e.afterAnyEvent=function(t,n,a,o,r){return e.doCallback(t,t.onafterevent||t.onevent,n,a,o,r)},e.leaveAnyState=function(t,n,a,o,r){return e.doCallback(t,t.onleavestate,n,a,o,r)},e.enterAnyState=function(t,n,a,o,r){return e.doCallback(t,t.onenterstate||t.onstate,n,a,o,r)},e.changeState=function(t,n,a,o,r){return e.doCallback(t,t.onchangestate,n,a,o,r)},e.beforeThisEvent=function(t,n,a,o,r){return e.doCallback(t,t["onbefore"+n],n,a,o,r)},e.afterThisEvent=function(t,n,a,o,r){return e.doCallback(t,t["onafter"+n]||t["on"+n],n,a,o,r)},e.leaveThisState=function(t,n,a,o,r){return e.doCallback(t,t["onleave"+a],n,a,o,r)},e.enterThisState=function(t,n,a,o,r){return e.doCallback(t,t["onenter"+o]||t["on"+o],n,a,o,r)},e.beforeEvent=function(t,n,a,o,r){return!1!==e.beforeThisEvent(t,n,a,o,r)&&!1!==e.beforeAnyEvent(t,n,a,o,r)},e.afterEvent=function(t,n,a,o,r){e.afterThisEvent(t,n,a,o,r),e.afterAnyEvent(t,n,a,o,r)},e.leaveState=function(t,n,a,o,r){var i=e.leaveThisState(t,n,a,o,r),c=e.leaveAnyState(t,n,a,o,r);return!1!==i&&!1!==c&&(typeof e.ASYNC!=typeof i&&typeof e.ASYNC!=typeof c||e.ASYNC)},e.enterState=function(t,n,a,o,r){e.enterThisState(t,n,a,o,r),e.enterAnyState(t,n,a,o,r)},e.buildEvent=function(t,n){return function(){var a=this.current,o=n[a]||(n[e.WILDCARD]!=e.WILDCARD?n[e.WILDCARD]:a)||a,r=Array.prototype.slice.call(arguments);if(this.transition)return this.error(t,a,o,r,e.Error.PENDING_TRANSITION,"event "+t+" inappropriate because previous transition did not complete");if(this.cannot(t))return this.error(t,a,o,r,e.Error.INVALID_TRANSITION,"event "+t+" inappropriate in current state "+this.current);if(!1===e.beforeEvent(this,t,a,o,r))return e.Result.CANCELLED;if(a===o)return e.afterEvent(this,t,a,o,r),e.Result.NOTRANSITION;var i=this;this.transition=function(){return i.transition=null,i.current=o,e.enterState(i,t,a,o,r),e.changeState(i,t,a,o,r),e.afterEvent(i,t,a,o,r),e.Result.SUCCEEDED},this.transition.cancel=function(){i.transition=null,e.afterEvent(i,t,a,o,r)};var c=e.leaveState(this,t,a,o,r);return!1===c?(this.transition=null,e.Result.CANCELLED):e.ASYNC===c?e.Result.PENDING:this.transition?this.transition():void 0}},e.VERSION="2.4.0",e.Result={SUCCEEDED:1,NOTRANSITION:2,CANCELLED:3,PENDING:4},e.Error={INVALID_TRANSITION:100,PENDING_TRANSITION:200,INVALID_CALLBACK:300},e.WILDCARD="*",e.ASYNC="async",e}();n.default=a,cc._RF.pop()},{}],Timer:[function(e,t,n){"use strict";cc._RF.push(t,"6f326ixHvBPxr5QMxvWsUjp","Timer"),Object.defineProperty(n,"__esModule",{value:!0});var a=cc._decorator,o=a.ccclass,r=a.property,i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._end_time=0,t.onTimeOut=null,t}return __extends(t,e),t.prototype.startTimer=function(e,t){this._end_time=e,this.onTimeOut=t},t.prototype.update=function(e){this._end_time>0&&(this._end_time-=e,this._end_time<0&&(this._end_time=0,null!=this.onTimeOut&&this.onTimeOut()),this.getComponent(cc.Label).string="Time: "+Math.floor(this._end_time).toString())},__decorate([r],t.prototype,"_end_time",void 0),__decorate([r],t.prototype,"onTimeOut",void 0),t=__decorate([o],t)}(cc.Component);n.default=i,cc._RF.pop()},{}]},{},["GameMgr","PlayChangeColor","Timer","CubeGameFSM","StateMachine"]);